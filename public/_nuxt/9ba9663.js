(window.webpackJsonp=window.webpackJsonp||[]).push([[147],{1119:function(t,e,o){"use strict";o.r(e);o(48),o(4),o(38),o(42),o(838),o(348);var n={name:"quotation",data:function(){return{title:"Sales Quotations",items:[{text:"Edit",action:"edit"},{text:"Delete",action:"delete"}],breadcrumb:[],form:{},audits:{},defaultItem:{},url:"/api/documents/form",dialogLoading:!1,showLoading:!1,itemAction:[],actionName:"Save"}},mounted:function(){var data={item:{text:this.title}};this.$refs.dialog.openDialog(data),this.getDataFromApi()},methods:{close:function(){this.$router.back(),this.$nuxt.$emit("getDataFromApi")},checkDisable:function(){return"closed"===this.form.status||"cancel"===this.form.status},arrowLink:function(t,e){var o=this;this.$axios.get(this.url+"/arrow",{params:{type:e,status:t,document:this.$route.query.document}}).then((function(t){o.$router.push({path:"/dashboard/documents/form",query:{document:t.data.data.id,type:e}}),setTimeout((function(){o.getDataFromApi()}),300)})).catch((function(t){o.$swal({type:"error",title:"Error",text:t.response.data.message})}))},getDataFromApi:function(t){var e=this;this.showLoading=!0;var o=this.$route.query.type;this.$axios.get(this.url+"/"+this.$route.query.document,{params:{type:o,copyFromId:t}}).then((function(t){var form="";e.audits=t.data.data.audits,t.data.data.count>0?(form=t.data.data.rows,e.actionName="Update"):(form=t.data.data.form,e.actionName="Save"),e.form=Object.assign({},form),e.defaultItem=Object.assign({},form),e.getBreadcrumb(o,form,form.status),setTimeout((function(){e.$refs.formDocument.setData(e.form)}),30)})).catch((function(t){var o=void 0!==t.response?t.response.data.message:t;e.$swal({type:"error",title:"Error",text:o})})).finally((function(t){e.showLoading=!1}))},actionDocument:function(t){var e=this;switch(t){case"SQ":case"SO":case"PQ":case"PO":var o=this.$route.query.document;this.$router.push({path:"/dashboard/documents/form",query:{document:0,type:t}}),setTimeout((function(){e.actionName="Save",e.getBreadcrumb(t,e.form,e.form.status),e.$refs.formDocument.changeValue("type",t),e.$refs.formDocument.changeValue("parent_id",o)}),300);break;case"C":this.$refs.formDocument.changeValue("status","cancel"),this.store();break;case"sendEmail":this.openDialogEmail()}},deleteDocument:function(t){var e=this,o=this;this.$swal({title:"Are you sure?",text:"The data will be deleted",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then((function(n){n.value&&e.$axios.delete(e.url+"/"+t).then((function(t){e.$swal({type:"success",title:"Success...",text:"Data Deleted!"}),e.$router.push({path:o.$helper.mappingAction(o.$route.query.type)})})).catch((function(t){e.$swal({type:"error",title:"Oops...",text:t.response.data.message})}))}))},printAction:function(t){switch(t){case"preview":this.previewDocument();break;case"sendEmail":this.openDialogEmail()}},openDialogEmail:function(){this.$refs.dialogSendEmail.openEmailDialog(this.form)},previewDocument:function(){var t=this,e=this;this.dialogLoading=!0,this.$axios.get("/api/documents/print",{params:{id:e.form.id},responseType:"arraybuffer"}).then((function(o){t.dialogLoading=!1;var n=window.URL.createObjectURL(new Blob([o.data])),link=document.createElement("a");link.href=n,link.setAttribute("download",e.form.document_number+".pdf"),document.body.appendChild(link),link.click()})).catch((function(e){t.dialogLoading=!1,t.$swal({type:"error",title:"Error",text:e.response.data.message})}))},getBreadcrumb:function(t,form,e){var text="0"!==this.$route.query.document?form.document_number:"Create Document";this.breadcrumb=[{text:"Dashboard",disabled:!1,to:{path:"/dashboard"}},{text:this.$helper.mapping(t),disabled:!1,to:{path:this.$helper.mappingAction(t)}},{text:text,disabled:!0,to:{path:"/dashboard/documents/form"}}]},mappingType:function(t){if("SQ"===t)return"/dashboard/sales/quote"},store:function(){var t=this,e="0"===this.$route.query.document?"post":"patch",o="0"===this.$route.query.document?this.url:this.url+"/"+this.$route.query.document,data=this.$refs.formDocument.returnData(this.$route.query.document);this.dialogLoading=!0,this.$axios({method:e,url:o,data:data}).then((function(e){t.$router.push({path:"/dashboard/documents/form",query:{document:e.data.data.id,type:e.data.data.type}}),t.$nuxt.$emit("snackbar",e.data.message),setTimeout((function(){t.getDataFromApi()}),50)})).catch((function(e){t.$swal({type:"error",title:"Error",text:e.response.data.message})})).finally((function(e){t.dialogLoading=!1}))}}},r=o(47),c=o(54),d=o.n(c),m=o(153),l=o(234),h=o(235),f=o(155),y=o(53),$=o(529),component=Object(r.a)(n,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("LazyFormDialogFull",{ref:"dialog",on:{close:t.close},scopedSlots:t._u([{key:"content",fn:function(){return[o("LazyDocumentFormDocument",{ref:"formDocument"})]},proxy:!0},{key:"actions",fn:function(){return[o("v-btn",{staticClass:"mr-3",attrs:{color:"green darken-1",dark:"",rounded:""},on:{click:t.close}},[t._v("\n      Save\n\n      "),o("v-menu",{attrs:{transition:"slide-y-transition",bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on,r=e.attrs;return[o("v-btn",t._g(t._b({attrs:{dark:"",icon:""}},"v-btn",r,!1),n),[o("v-icon",[t._v("mdi-menu-down")])],1)]}}])},[t._v(" "),o("v-list",t._l(t.items,(function(e,i){return o("v-list-item",{key:i},[o("v-list-item-content",[o("v-list-item-title",[t._v(t._s(e.text))])],1)],1)})),1)],1)],1)]},proxy:!0}])})}),[],!1,null,null,null);e.default=component.exports;d()(component,{VBtn:m.a,VIcon:l.a,VList:h.a,VListItem:f.a,VListItemContent:y.a,VListItemTitle:y.c,VMenu:$.a})}}]);